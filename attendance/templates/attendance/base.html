<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}Посещаемость{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'attendance/bootstrap/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'attendance/bootstrap/bootstrap-icons.min.css' %}">
    <link rel="stylesheet" href="{% static 'attendance/css/base.css' %}">
    {% block extra_head %}{% endblock %}
</head>

<body>
<div class="layout">

    <header class="app-header sticky-top">
        <nav class="navbar navbar-expand-lg navbar-dark app-navbar border-bottom">
            <div class="container-fluid px-3 px-lg-4">

                <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'index' %}">
                    <i class="bi bi-mortarboard-fill"></i>
                    <span class="fw-semibold">Школьная посещаемость</span>
                </a>

                {% if user.is_authenticated %}
                    <button class="navbar-toggler" type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#topNav"
                            aria-controls="topNav"
                            aria-expanded="false"
                            aria-label="Открыть меню">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="topNav">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0 gap-lg-1">

                            <li class="nav-item">
                                <a href="{% url 'index' %}"
                                   class="nav-link{% if request.path == '/' %} active{% endif %}">
                                    <i class="bi bi-house-door me-1"></i> Главная
                                </a>
                            </li>

                            {% if is_deputy and not request.session.substitute_as %}
                                <li class="nav-item">
                                    <a href="{% url 'statistics' %}"
                                       class="nav-link{% if '/statistics' in request.path %} active{% endif %}">
                                        <i class="bi bi-graph-up me-1"></i> Статистика
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'substitute_tokens' %}"
                                       class="nav-link{% if '/substitute-tokens' in request.path %} active{% endif %}">
                                        <i class="bi bi-key me-1"></i> Токены замены
                                    </a>
                                </li>
                            {% endif %}

                            {% if not request.session.substitute_as %}
                                <li class="nav-item">
                                    <a href="{% url 'manage_students' %}"
                                       class="nav-link{% if '/students' in request.path %} active{% endif %}">
                                        <i class="bi bi-people me-1"></i> Управление учениками
                                    </a>
                                </li>
                            {% endif %}

                            {% if user.is_staff and not request.session.substitute_as %}
                                <li class="nav-item">
                                    <a href="{% url 'admin:index' %}"
                                       class="nav-link{% if '/admin' in request.path %} active{% endif %}">
                                        <i class="bi bi-gear me-1"></i> Админка
                                    </a>
                                </li>
                            {% endif %}

                        </ul>

                        <div class="d-flex align-items-start align-items-lg-center gap-2 gap-lg-3 mt-3 mt-lg-0">
                            <div class="text-light small lh-sm text-end">
                                <div class="fw-semibold">
                                    {{ user.get_full_name|default:user.username }}
                                </div>
                                <div class="d-flex justify-content-end gap-1 mt-1">
                                    {% if is_deputy %}
                                        <span class="badge app-badge app-badge-deputy">Завуч</span>
                                    {% elif is_teacher %}
                                        <span class="badge app-badge app-badge-teacher">Учитель</span>
                                    {% endif %}
                                </div>
                            </div>

                            <form action="{% url 'logout' %}" method="post" class="m-0">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-light btn-sm">
                                    <i class="bi bi-box-arrow-right me-1"></i> Выйти
                                </button>
                            </form>
                        </div>
                    </div>
                {% else %}
                    <div class="ms-auto">
                        <a href="{% url 'login' %}" class="btn btn-primary btn-sm">
                            <i class="bi bi-box-arrow-in-right me-1"></i> Войти
                        </a>
                    </div>
                {% endif %}

            </div>
        </nav>
    </header>

    <main class="content container-xxl py-3 py-lg-4">
        {% if messages %}
            <div class="mb-3">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} mb-2" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

</div>

<script src="{% static 'attendance/bootstrap/bootstrap.bundle.min.js' %}"></script>
{% block script %}{% endblock %}
</body>
</html>